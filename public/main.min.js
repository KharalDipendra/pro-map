let setMode,spots,poke,loc,lod,getSpotData,setPokemon,locdatas,headbutt,digspot,search,dat=[],locs=[],cs=[],pokes=[],MODE="loc";const daytime=e=>{let a=1==e[0],t=1==e[1],o=1==e[2],n="";return n=1==a&&1==t&&1==o?"M/D/N":1==a&&1==t&&0==o?"M/D":1==a&&0==t&&1==o?"M/N":1==a&&0==t&&0==o?"M":0==a&&0==t&&1==o?"N":0==a&&1==t&&1==o?"D/N":0==a&&1==t&&0==o?"D":"Ugh"};$(async()=>{function e(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/p1/,"").trim()).replace(/p2/,"").trim()).replace(/p3/,"").trim()).replace(/p4/,"").trim()).replace(/p5/,"").trim()).replace(/p6/,"").trim()).replace(/p7/,"").trim()).replace(/p8/,"").trim()).replace(/p9/,"").trim()).replace(/p10/,"").trim()}async function a(a){let t="";for(var o in a){let n=a[o],s="";s=locdatas[e(o)]?"red":"var(--col-cyan)",0==n.x&&0==n.y||(o=o,t+=`<div class="spot tooltip"style="top:${n.y}px; left:${n.x}px;" id="${o}" onclick="getSpotData('${o}')"><span class="bottom"><span style="color:${s};">${e(o)}</span></span><div class="draw"></div></div>`)}spots.html(t),lod.css("animation","goup 1.2s linear 0s 1"),setTimeout(()=>{lod.css("display","none")},600)}dat=[],spots=$("#spots"),lod=$("#loading"),locs=[],pokes=[],cs=[],MODE="loc",poke=$("#selection"),loc=$("#locsel"),getSpotData=(a=>{setMode("loc"),t(a);let o,n,s={innerHTML:""},i=digspot.find(t=>t.loc.toLowerCase()==e(a).toLowerCase()),l=headbutt.find(t=>t.loc.toLowerCase()==e(a).toLowerCase());if(!(o=a.startsWith("Route")?dat.find(t=>t.Map.toLowerCase()===e(a.toLowerCase())):dat.find(e=>e.Map.toLowerCase().startsWith(a.toLowerCase()))))return $("#inner-data").html(""),t(a),$("#inner-data").html("No spawns at "+e(a)+"."+$("#inner-data").html()),changeTab("map");s.innerHTML='<h2 style="color:var(--col-cyan);">'+e(o.Map)+"</h2>",n=(n=a.startsWith("Route")?dat.filter(e=>e.Map.toLowerCase()==o.Map.toLowerCase()):dat.filter(e=>e.Map.toLowerCase().startsWith(o.Map.toLowerCase()))).sort((e,a)=>a.Tier-e.Tier);let c="";locdatas[e(a)]&&(c+=""),c+=n.map(e=>`\n<div class="sdata">\n<span style="font-size: 20px;color:var(--col-cyan); padding-top: 4px; padding-bottom: 4px;">#${e.MonsterID} ${e.Pokemon}</span>\n<br>\n<b>Daytime</b> - ${daytime(e.Daytime)}, \n<b>Level Range</b> - ${e.MinLVL} to ${e.MaxLVL}, <b>Tier</b> - ${e.Tier}, <b>Item</b> - ${e.Item||"None"}, <b>MS</b>: ${1==e.MemberOnly?"Yes":"No"}, <b>Fishing</b> - ${null!=e.Fishing?"Surf/Fish":"Land"}\n</div>\n\t\t`).join("");let r={};i&&(c=`\n<div class="sdata">\n<span style="font-size: 20px;color:var(--col-cyan); padding-top: 4px; padding-bottom: 4px;">Digspots Data</span>\n<br>\n<b>Pokémon</b>: ${(r=i).pokes.join(", ")}<br>\n<b>Items</b>: ${r.items.join(", ")}\n</div>\n\t\t`+c),l&&(c=`\n<div class="sdata">\n<span style="font-size: 20px;color:var(--col-cyan); padding-top: 4px; padding-bottom: 4px;">Headbutt Data</span>\n<br>\n<b>Pokémon</b>: ${(r=l).pokes.join(", ")}<br>\n<b>Items</b>: ${r.items.join(", ")}\n</div>\n\t\t`+c),s.innerHTML+=c,changeTab("map"),$("#locsel").html('Location: <a href="javascript:void(0);" style="color:var(--col-cyan);" onclick="changeTab(\'map\')">'+e(a)+"</a>"),$("#inner-data").html($("#inner-data").html()+s.innerHTML),window.innerHeight>window.innerWidth&&(window.location.href="#data")}),setPokemon=(a=>{{let t={innerHTML:""},o=document.getElementById("selection");0!=cs.length&&(cs.forEach(e=>{e.style.opacity=0}),cs=[]),t.innerHTML="Searching...";let n=a||o.options[o.selectedIndex].value,s=dat.filter(e=>e.Pokemon.toLowerCase()==n.toLowerCase()),i=[...document.getElementById("spots").children];t.innerHTML=`<h2 style="color: var(--col-cyan);">${n}</h2>`,s.forEach(a=>{let t;(t=a.Map.startsWith("Route")?i.find(t=>a.Map.toLowerCase()==e(t.id.toLowerCase())):i.find(t=>a.Map.toLowerCase().startsWith(e(t.id).toLowerCase())))&&a.Pokemon==n&&((t=[...t.children].find(e=>"draw"==e.className)).style.opacity="0.6",t.Tier=a.Tier,t.MemberOnly=a.MemberOnly,t.Map=a.Map,t.Fishing=a.Fishing,cs.push(t))}),cs=(cs=[...new Set(cs)]).sort((e,a)=>e.Tier-a.Tier),t.innerHTML=s.map((e,a)=>`\n<div class="sdata">\n<span style="font-size: 20px;color:var(--col-cyan); padding-top: 4px; padding-bottom: 4px;">#${a+1} ${e.Map}</span>\n<br>\n<b>Daytime</b> - ${daytime(e.Daytime)}, \n<b>Level Range</b> - ${e.MinLVL} to ${e.MaxLVL}, <b>Tier</b> - ${e.Tier}, <b>Item</b> - ${e.Item||"None"}, <b>MS</b>: ${1==e.MemberOnly?"Yes":"No"}, <b>Fishing</b> - ${null!=e.Fishing?"Surf/Fish":"Land"}\n</div>`).join(""),changeTab("map"),$("#inner-data").html(t.innerHTML),window.innerHeight>window.innerWidth&&(window.location.href="#data")}});const t=a=>{let t=locdatas[e(a)];$("#inner-data").html(""),t&&$("#inner-data").html(`\n<div class="sdata">\n<h2 style="color:var(--col-cyan);">Location Landmarks</h2>\n<ul>\n${t.split(",").map(e=>"<li>"+e.trim()+"</li>").join("")}\n</ul>\n</div>\n`)};search=(e=>{let a=e||$("#search").val();if("poke"==MODE){let e=dat.filter(e=>e.Pokemon.toLowerCase().includes(a.toLowerCase()));if(0==e.length)return $("#search-data").html("Cannot find such Pokémon in spawn data.");$("#search-data").html([...new Set(e.map(e=>e.Pokemon))].map(e=>`\n<div class="sdata" style="color:var(--col-cyan); text-align: left;">\n<a href="javascript:void(0);" onclick="setPokemon('${e}')">${e}</a>\n</div>\n`).join(""))}else{let e=dat.filter(e=>e.Map.toLowerCase().includes(a.toLowerCase()));if(0==e.length)return $("#search-data").html("Cannot find such Location in spawn data.");$("#search-data").html([...new Set(e.map(e=>e.Map))].map(e=>`\n<div class="sdata" style="color:var(--col-cyan); text-align: left;">\n<a href="javascript:void(0);" onclick="getSpotData('${e}')">${e}</a>\n</div>\n`).join(""))}}),(setMode=(e=>{"poke"==(MODE=e)?(loc.css("display","none"),poke.css("display","inline-block"),$("#btn-poke").addClass("active"),$("#btn-loc").removeClass("active")):(loc.css("display","inline-block"),poke.css("display","none"),$("#btn-poke").addClass("active"),$("#btn-loc").removeClass("active"),0!=cs.length&&(cs.forEach(e=>{e.style.opacity=0}),cs=[]))}))("loc"),await async function(){let e=await fetch(window.location.protocol+"//"+window.location.host+"/lspawns");dat=await e.json(),async function(){dat.forEach(e=>{find=locs.find(a=>a==e.Map),find||locs.push(e.Map)})}(),async function(){dat.forEach(e=>{find=pokes.find(a=>a==e.Pokemon),find||pokes.push(e.Pokemon)}),pokes=pokes.sort(),poke.html(pokes.map(e=>`<option value="${e}">${e}</option>`).join(""))}();let t=await fetch(window.location.protocol+"//"+window.location.host+"/spots3");t=await t.json(),locdatas=await fetch(window.location.protocol+"//"+window.location.host+"/locs"),headbutt=await fetch(window.location.protocol+"//"+window.location.host+"/headbutt"),headbutt=await headbutt.json(),digspot=await fetch(window.location.protocol+"//"+window.location.host+"/digspot"),digspot=await digspot.json(),locdatas=await locdatas.json(),a(t)}();let o=window.location.href.split("/?")[1];if(o){let e=(o=o.split("&").map(e=>e.split("=")).map(e=>({key:e[0],value:e[1]||null}))).find(e=>"poke"==e.key||"loc"==e.key||"tab"==e.key||"search"==e.key||"mode"==e.key);if(e&&e.value)if(e.value=e.value.replace(/\++/g," "),"poke"==e.key)setPokemon(e.value);else if("loc"==e.key)getSpotData(e.value);else if("tab"==e.key)["map","select","about"].includes(e.value)&&(e.value=e.value.replace("select","options"),changeTab(e.value));else if("search"==e.key){let a=o.find(e=>"mode"==e.key);a&&("loc"!=a.value&&"poke"!=a.value||(setMode(a.value),changeTab("options"),search(e.value)))}else"mode"==e.key&&("loc"!=e.value&&"poke"!=e.value||setMode(e.value))}});